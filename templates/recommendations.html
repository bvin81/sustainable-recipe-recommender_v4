<!-- templates/recommendations.html -->
{% extends "base.html" %}

{% block title %}Recept Aj√°nl√°sok - Sustainable Recipe Recommender{% endblock %}

{% block content %}
<div class="card">
    <h2>üçΩÔ∏è Recept Aj√°nl√°sok</h2>
    <p>K√©rj√ºk, √©rt√©kelje az al√°bbi recepteket 1-5 sk√°l√°n (1=egy√°ltal√°n nem tetszik, 5=nagyon tetszik):</p>
    
    {% if version == 'A' %}
    <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 20px 0;">
        <p><strong>‚ÑπÔ∏è Az aj√°nl√°sok r√©szletes pontsz√°mokkal:</strong> Minden receptn√©l l√°thatja az eg√©szs√©g√ºgyi, k√∂rnyezeti √©s √≠zl√©si √©rt√©keket.</p>
    </div>
    {% else %}
    <div style="background: #f3e5f5; padding: 15px; border-radius: 8px; margin: 20px 0;">
        <p><strong>‚ÑπÔ∏è Az aj√°nl√°sok egyszer≈± form√°ban:</strong> A receptek a fenntarthat√≥s√°g alapj√°n vannak kiv√°lasztva.</p>
    </div>
    {% endif %}
    
    <div id="recipes-container">
        {% for recipe in recipes %}
        <div class="recipe-card" data-recipe-id="{{ recipe.id }}">
            <h3>{{ recipe.name }}</h3>
            
            {% if version == 'A' %}
            <!-- Detailed version with scores -->
            <div style="margin: 15px 0;">
                <div style="margin: 8px 0;">
                    <label>üè• Eg√©szs√©g√ºgyi √©rt√©k: {{ "%.0f"|format(recipe.health_score) }}/100</label>
                    <div class="score-bar">
                        <div class="score-fill" style="width: {{ recipe.health_score }}%;"></div>
                    </div>
                </div>
                
                <div style="margin: 8px 0;">
                    <label>üåç K√∂rnyezeti √©rt√©k: {{ "%.0f"|format(recipe.environmental_score) }}/100</label>
                    <div class="score-bar">
                        <div class="score-fill" style="width: {{ recipe.environmental_score }}%; background: linear-gradient(90deg, #4CAF50, #2E7D32);"></div>
                    </div>
                </div>
                
                <div style="margin: 8px 0;">
                    <label>üòã √çzl√©si √©rt√©k: {{ "%.0f"|format(recipe.meal_score) }}/100</label>
                    <div class="score-bar">
                        <div class="score-fill" style="width: {{ recipe.meal_score }}%; background: linear-gradient(90deg, #FF9800, #F57C00);"></div>
                    </div>
                </div>
                
                <div style="margin: 8px 0; padding-top: 10px; border-top: 1px solid #ddd;">
                    <label><strong>üìä √ñsszes√≠tett pontsz√°m: {{ "%.0f"|format(recipe.composite_score) }}/100</strong></label>
                    <div class="score-bar">
                        <div class="score-fill" style="width: {{ recipe.composite_score }}%; background: linear-gradient(90deg, #9C27B0, #673AB7);"></div>
                    </div>
                </div>
            </div>
            
            <div style="background: #f5f5f5; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <p><strong>üìù Magyar√°zat:</strong> {{ recipe.explanation }}</p>
            </div>
            {% endif %}
            
            <div style="margin: 15px 0;">
                <p><strong>ü•ò Hozz√°val√≥k:</strong> {{ recipe.ingredients|join(', ') }}</p>
            </div>
            
            <div style="margin: 15px 0;">
                <p><strong>üë©‚Äçüç≥ Elk√©sz√≠t√©s:</strong></p>
                <p style="margin-left: 20px;">{{ recipe.instructions }}</p>
            </div>
            
            <div style="margin-top: 20px; padding-top: 15px; border-top: 2px solid #ddd;">
                <label><strong>‚≠ê Az √ñn √©rt√©kel√©se (1-5):</strong></label>
                <div style="margin: 10px 0;">
                    {% for i in range(1, 6) %}
                    <label style="display: inline-block; margin-right: 15px; cursor: pointer;">
                        <input type="radio" name="rating_{{ recipe.id }}" value="{{ i }}" style="width: auto; margin-right: 5px;" onchange="submitRating('{{ recipe.id }}', {{ i }}, {{ recipe.health_score }}, {{ recipe.environmental_score }}, {{ recipe.meal_score }}, {{ recipe.composite_score }})">
                        {{ i }} ‚≠ê
                    </label>
                    {% endfor %}
                </div>
                <div id="rating-status-{{ recipe.id }}" style="color: #4CAF50; font-weight: bold; display: none;">
                    ‚úÖ √ârt√©kel√©s mentve!
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <div class="navigation">
        <a href="{{ url_for('user_study.questionnaire') }}" class="btn btn-primary" id="continue-btn" style="display: none;">
            ‚û°Ô∏è Tov√°bb a k√©rd≈ë√≠vhez
        </a>
        <p id="rating-instructions" style="color: #666; margin-top: 15px;">
            K√©rj√ºk, √©rt√©kelje az √∂sszes receptet a folytat√°shoz.
        </p>
    </div>
</div>

<script>
let ratingsSubmitted = 0;
const totalRecipes = {{ recipes|length }};

function submitRating(recipeId, rating, healthScore, envScore, mealScore, compositeScore) {
    fetch('/rate_recipe', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            recipe_id: recipeId,
            rating: rating,
            health_score: healthScore,
            environmental_score: envScore,
            meal_score: mealScore,
            composite_score: compositeScore
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            document.getElementById('rating-status-' + recipeId).style.display = 'block';
            ratingsSubmitted++;
            
            if (ratingsSubmitted >= totalRecipes) {
                document.getElementById('continue-btn').style.display = 'inline-block';
                document.getElementById('rating-instructions').style.display = 'none';
            }
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Hiba t√∂rt√©nt az √©rt√©kel√©s ment√©sekor. K√©rj√ºk, pr√≥b√°lja √∫jra.');
    });
}
</script>
{% endblock %}
